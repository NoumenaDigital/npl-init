package demo;

@api
protocol[greeter] HelloWorld() {

    initial state ungreeted;
    final state greeted;

    @api
    permission[greeter] sayHello() returns Text | ungreeted {
        become greeted;
        return "Hello " + getUsername(greeter) + "!";
    };
};

function getUsername(party: Party) returns Text -> 
    party.entity()
    .getOrNone("preferred_username")
    .getOrFail()
    .toList()
    .get(0);
